<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Directo</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
        }
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #25D366;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
        }
        #login-form {
            background: white;
            padding: 30px; /* Aumentado padding */
            border-radius: 10px;
            color: #333;
            width: 90%; /* Un poco m치s ancho en m칩viles */
            max-width: 320px; /* Ligeramente m치s grande */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* Sombra m치s pronunciada */
        }
        #login-form h2 {
            margin-top: 0;
            color: #128C7E; /* Color t칤tulo */
        }
         #login-form p {
            margin-bottom: 15px;
            color: #555; /* Color texto */
         }
        #password {
            box-sizing: border-box; /* Incluir padding y border en el width */
            width: 100%;
            padding: 12px; /* M치s padding */
            margin-bottom: 15px; /* Espacio antes del bot칩n */
            border: 1px solid #ccc; /* Borde m치s sutil */
            border-radius: 5px;
            font-size: 16px;
        }
        #unlock-btn {
            background: #128C7E;
            color: white;
            border: none;
            padding: 12px 15px; /* M치s padding */
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background 0.3s ease; /* Transici칩n suave */
        }
        #unlock-btn:hover {
            background: #075E54;
        }
        .hidden {
            display: none !important; /* A침adido !important por si acaso */
        }
        #error-msg {
            color: red;
            margin-top: 15px; /* M치s espacio */
            display: none; /* Oculto por defecto */
            font-weight: bold;
        }

        /* Estilos b치sicos para el contenido de la app (opcional) */
        #app-content {
            padding: 20px;
            text-align: center;
        }
        #app-content input[type="tel"] {
             padding: 10px;
             margin-right: 10px;
             border: 1px solid #ccc;
             border-radius: 5px;
        }
         #app-content button {
             padding: 10px 15px;
             background-color: #25D366;
             color: white;
             border: none;
             border-radius: 5px;
             cursor: pointer;
         }
         #app-content button:hover {
             background-color: #128C7E;
         }
    </style>
</head>
<body>
    <!-- Pantalla de login -->
    <div id="login-screen">
        <div id="login-form">
            <h2>游 Acceso Privado</h2>
            <p>Ingresa tu clave personal</p>
            <input type="password" id="password" placeholder="Clave" autocomplete="current-password"> <!-- autocomplete="current-password" es m치s sem치ntico -->
            <button id="unlock-btn">Desbloquear</button>
            <p id="error-msg">Clave incorrecta. Intenta de nuevo.</p>
        </div>
    </div>

    <!-- Contenido de la app -->
    <div id="app-content" class="hidden">
        <!-- ********************************** -->
        <!-- ASEG칔RATE DE QUE EL C칍DIGO QUE PEGUES AQU칈 NO TENGA ERRORES -->
        <!-- C칩digo de ejemplo b치sico: -->
        <h1>WhatsApp Directo</h1>
        <input type="tel" id="phoneNumber" placeholder="Ej: 51987654321"> <!-- Incluir c칩digo pa칤s si es necesario -->
        <button id="sendButton">Abrir Chat</button>
        <p style="margin-top:20px; font-size: small; color: grey;">App Desbloqueada</p>
        <!-- ********************************** -->
    </div>

    <script>
        // Configuraci칩n
        const CLAVE_CORRECTA = "1234"; // 춰C치mbiala por tu clave real!

        // Elementos DOM
        const loginScreen = document.getElementById('login-screen');
        const appContent = document.getElementById('app-content');
        const passwordInput = document.getElementById('password');
        const unlockBtn = document.getElementById('unlock-btn');
        const errorMsg = document.getElementById('error-msg');

        // Asegurarse de que los elementos existen antes de usarlos
        if (!loginScreen || !appContent || !passwordInput || !unlockBtn || !errorMsg) {
            console.error("Error cr칤tico: No se encontraron todos los elementos del DOM necesarios.");
            alert("Error al cargar la p치gina. Faltan elementos.");
        } else {
            // 1. Sistema de autenticaci칩n mejorado para Vercel
            function handleLogin() {
                console.log("Bot칩n Desbloquear presionado."); // Log 1
                errorMsg.style.display = 'none'; // Ocultar mensaje de error previo

                if (passwordInput.value === CLAVE_CORRECTA) {
                    console.log("Contrase침a CORRECTA. Procediendo a desbloquear..."); // Log 2

                    try {
                        // M칠todo 1: Usar hash en la URL (funciona siempre)
                        window.location.hash = "unlocked";
                        console.log("Hash URL establecido a #unlocked."); // Log 3

                        // M칠todo 2: Cookie de respaldo (con SameSite=Lax para navegadores modernos)
                        document.cookie = "appAuth=true; max-age=3600; path=/; SameSite=Lax"; // 1 hora
                        console.log("Cookie 'appAuth=true' establecida."); // Log 4

                        // Ocultar login y mostrar app
                        loginScreen.classList.add('hidden');
                        appContent.classList.remove('hidden');
                        console.log("Pantalla de login oculta, contenido de app mostrado."); // Log 5

                        // Opcional: Limpiar campo de contrase침a despu칠s de 칠xito
                        // passwordInput.value = '';

                    } catch (error) {
                         console.error("Error durante el proceso de desbloqueo:", error);
                         alert("Ocurri칩 un error al intentar desbloquear la aplicaci칩n.");
                    }

                } else {
                    console.warn("Contrase침a INCORRECTA."); // Log 6 (Warn)
                    errorMsg.style.display = 'block'; // Mostrar mensaje de error
                    passwordInput.focus(); // Poner el foco de nuevo en el input
                    passwordInput.select(); // Seleccionar el texto para f치cil reemplazo
                }
            }

            // 2. Verificar autenticaci칩n al cargar la p치gina
            function checkAuth() {
                console.log("Verificando autenticaci칩n al cargar..."); // Log 7
                let isAuthenticated = false;

                // Verificar hash URL
                if (window.location.hash === "#unlocked") {
                    console.log("Autenticado v칤a Hash URL."); // Log 8
                    isAuthenticated = true;
                } else {
                    // Verificar cookie si el hash no est치
                    if (document.cookie.split(';').some(c => c.trim().startsWith('appAuth=true'))) {
                       console.log("Autenticado v칤a Cookie."); // Log 9
                       isAuthenticated = true;
                    }
                }

                if (isAuthenticated) {
                    loginScreen.classList.add('hidden');
                    appContent.classList.remove('hidden');
                    console.log("Acceso concedido al cargar p치gina."); // Log 10
                } else {
                    console.log("No autenticado al cargar. Mostrando login."); // Log 11
                    loginScreen.classList.remove('hidden'); // Asegurarse que el login est칠 visible si no hay auth
                    appContent.classList.add('hidden'); // Asegurarse que la app est칠 oculta
                }
            }

            // 3. Event listeners
            unlockBtn.addEventListener('click', handleLogin);
            passwordInput.addEventListener('keypress', (e) => {
                // Ocultar error al empezar a escribir de nuevo
                if (errorMsg.style.display === 'block') {
                    errorMsg.style.display = 'none';
                }
                // Permitir login con Enter
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });

            // Inicializaci칩n
            checkAuth(); // Verificar auth al inicio
            console.log("App inicializada. Estado de autenticaci칩n verificado."); // Log 12
        }

        // Aqu칤 ir칤a la l칩gica JS espec칤fica de tu app WhatsApp Directo
        // (la que maneja phoneNumber y sendButton), si la tienes separada.
        // Ejemplo b치sico:
        const phoneInput = document.getElementById('phoneNumber');
        const sendBtn = document.getElementById('sendButton');

        if(phoneInput && sendBtn) {
            sendBtn.addEventListener('click', () => {
                const phone = phoneInput.value.trim();
                if (phone) {
                    // Asume que el n칰mero ya incluye c칩digo de pa칤s si es necesario
                    // O ajusta para a침adirlo si no lo tiene. Ej: si es de Per칰 y tiene 9 d칤gitos:
                    let fullPhone = phone;
                    // if (phone.length === 9 && !phone.startsWith('51')) { // Ejemplo para Per칰
                    //     fullPhone = '51' + phone;
                    // }
                    const url = `https://wa.me/${fullPhone.replace(/[^0-9]/g, '')}`; // Limpia no n칰meros
                    console.log("Abriendo chat:", url);
                    window.open(url, '_blank');
                } else {
                    alert("Por favor, ingresa un n칰mero de tel칠fono.");
                }
            });
        } else {
             console.warn("No se encontraron los elementos de la app WhatsApp (phoneNumber, sendButton). Aseg칰rate de que est칠n en el HTML dentro de #app-content.");
        }

    </script>
</body>
</html>
